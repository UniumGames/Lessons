### Анимация

В любой игре есть анимация: анимация персонажей, камеры, предметов. В этом занятии рассмотрим как менять персонажа с видом от третьего лица, анимировать предметы и персонажей.

### Замена модели в Third Person Character

Рассмотрим как заменить модель человека в Third Person Character. Модель должна быть специально подготовлена для использования в играх.

1. Добавь трехмерную модель в проект.

2. Выдели модель на панели «**Project**». На панели «**Inspector**» выбери следующие настройки:

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/humanoid_rig.jpg)

   Будет создан аватар модели.

3. Добавь на сцену «**ThirdPersonController**».

4. Добавь свою модель на сцену. Расположи ее на том же месте, что и ThirdPersonController. Перетащи ее внутрь ThirdPersonController:

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/third1.jpg)

5. Внутри «**ThirdPersonController**» удали все объекты, кроме своей модели:

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/third2.jpg)

6. Выдели объект «**ThirdPersonController**». На панели «**Inspector**» в параметре «**Avatar**» выбери аватар своей модели.

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/third3.jpg)

   При необходимости настрой «**Capsule Collider**» по высоте модели.

### Анимация на основе ключевых кадров

В мультфильмах художнику приходиться рисовать каждый кадр, чтобы создать анимацию. В трехмерной графике и в игровых движках нам не надо анимировать каждый кадр. Мы можем задать начальное и конечное значение перемещения объекта, а программа автоматически просчитает промежуточные значения объекта. Начальное и конечное значение — это и есть ключевые кадры. C помощью игрового движка Unity можно создать простую анимацию такую как: анимацию дверей, подъем платформ или кабины лифта и прочего. Для более сложной анимации следует использовать сторонние программы по редактированию трехмерной графики: Blender (по этой программе есть отдельный курс), Autodesk 3DS Max, Autodesk Maya, Houdini и т.п.

![anim](http://unity3d.unium.ru/lessons/lesson15/images/keyanimtheory.png)

### Создание анимации (Animation)

1. Выдели на сцене объект, который хочешь анимировать.
2. Открой панель в главном меню «**Window**» → «**Animation**». Нажми кнопку «**Create**», введи имя файла, в котором будет сохранена анимация.
3. ![img](http://unity3d.unium.ru/lessons/lesson15/images/anim1.jpg)
4. нажми кнопку ![img](http://unity3d.unium.ru/lessons/lesson15/images/anim2.jpg), чтобы начать запись анимации (не забудь ее потом отключить).
5. Выбери 0-ую секунду (первый кадр). Перемести объект в начальную позицию. Выбери последний кадр. Перемести объект в другую сторону. Кадры автоматически создаются при перемещии объекта на сцене. Кадры можно перемещать, удалять кнопкой Del.

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/anim3.jpg)

### Граф состояний (Animator)

![img](http://unity3d.unium.ru/lessons/lesson15/images/animator1.jpg)

Вместе с анимацией (Animation) создается аниматор (Animator Controller). Аниматор — граф состояний, где каждое состояние — это анимация. Между состояниями граф может переходить в зависимости от условий. Можно настраивать плавность перехода между состояниями.

1. Создай несколько анимаций одного объекта (в этом примере две анимации по имени Anim1 и Anim2).
2. На панели «**Project**» открой двойным нажатием файл графа. Имя графа совпадает с именем анимируемого объекта.![img](http://unity3d.unium.ru/lessons/lesson15/images/animator2.jpg)
3. Откроется панель «**Animator**». На графе из входной точки (Entry) посылается сигнал в первую анимацию. Поэтому, при запуске игры именно она и будет воспроизводиться.

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/animator3.jpg)
4. Чтобы запустить вторую анимацию, нажми ![img](http://unity3d.unium.ru/images/rmb.png) на первой анимации. Выбери «**Make Transition**» и выбери вторую анимацию.
5. Можно изменить степень наложения анимации. Для этого выбери соединительную линию между анимациями. На панели «**Inspector**» будут следующие настройки:

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/animator4.jpg)

### Управление графом состояния с помощью параметров

Управлять графом можно с помощью параметров. Разберем пример, когда есть две анимации. Вторая анимация должна проигрываться только тогда, когда игрок входит в зону триггера.

1. Открой граф аниматора.

2. ![img](http://unity3d.unium.ru/lessons/lesson15/images/scriptanim1.jpg)

3. Введи имя параметра (пример: StartAnim2).

4. Выдели соединительную линию (переход) между анимациями.

5. ![img](http://unity3d.unium.ru/lessons/lesson15/images/scriptanim2.jpg)

   Если включен параметр «**Has Exit Time**», то анимация проиграется до конца и только потом будет переход к следующей анимации.

6. Если сейчас запустить игру, то будет воспроизводиться только первая анимация (т.к. параметр StartAnim2 выключен).

7. С помощью скрипта можно включить или выключить параметр аниматора:

   ```csharp
   // при срабатывании триггера
   void OnTriggerEnter(Collider Other) {
   	// вытаскиваем компонент Animator
   	Animator animator = GetComponent<Animator>();
   	// устанавливаем параметр StartAnim2 в состояние true
   	animator.SetBool("StartAnim2", true);
   }
   ```

### Импорт анимации

Чаще всего, анимацию создают в специальных программах (Blender, Maya, 3DS Max), а в Unity ее используют. Причем, одна модель может хранить в себе несколько анимаций. Анимация состоит из набора кадров. Чаще всего аниматоры записывают в текстовый файл какие анимации содержит модель и в каких кадрах они находятся. Рассмотрим процесс импорта анимации человека и использования в аниматоре.

1. Добавь трехмерную модель человека, которая содержит анимацию.
2. Выдели ее на панели «**Project**»
3. На панели «**Inspector**» в закладке «**Rig**» выбери следующие параметры:

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/import1.jpg)
4. в соседней закладке «**Animations**» включи параметр «**Import Animation**». Нажми кнопку «**Apply**», чтобы появились дополнительные настройки. Добавь в таблице анимации, задав первый и последний кадр. Имя анимации должно быть уникальным.

   ![img](http://unity3d.unium.ru/lessons/lesson15/images/import2.jpg)
5. На панели «**Project**» нажми ![img](http://unity3d.unium.ru/images/rmb.png) → «**Create**» → «**Animator Controller**». Введи имя аниматора. Открой редактор аниматора.
6. Для создания нового состояния нажми ![img](http://unity3d.unium.ru/images/rmb.png) → «**Create State**» → «**Empty**». Выдели новое состояние. Сейчас это состояние не содержит анимации. На панели «**Inspector**» в параметре «**Motion**» выбери анимацию.
7. Когда аниматор создан, то его нужно присвоить к объекту на сцене. Выдели модель на сцене. Добавь компонент «**Animator**» (если его нет). В параметре «**Controller**» выбери созданный аниматор.