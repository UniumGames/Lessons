### Загрузка уровней

Любая игра разбита на несколько уровней. Это значительно увеличивает производительность игры и упрощает ее создание.

1. Создай первый уровень и сохрани его с уникальным именем, выбрав в главном меню «**File**» → «**Save Scene As…**»;
2. Добавь в проект новый уровень выбрав в главном меню «**File**» → «**New Scene**». Когда уровень будет готов, сохрани его («**File**» → «**Save Scene As…**»);
3. Открой уровень на панели «**Project**», который будет открываться при запуске игры. Выбери в главном меню«** File**» → «**Build Settings…**». Нажми кнопку «**Add Open Scenes**», чтобы текущий уровень добавился в список «**Scenes In Build**». Повтори эти операции с другими уровнями, чтобы все они добавились в список «**Scenes In Build**»;
4. Далее, чтобы загрузить уровень с помощью скрипта добавь ноду «**Load Level**» которую можно найти на панели инструментов в списке «**Actions**» → «**Level**». На панели свойств в параметре «**Level Name**» введи название уровня.

![](http://unity3d.unium.ru/lessons/lesson11/images/loadlevel.jpg)

### Выход из игры

Игры для компьютера должны иметь точку выхода в операционную систему Windows. Чтобы выйти из игры используй ноду «**Quit**» («**Actions**» → «**Application**»). Эта нода работает только тогда, когда создан build игры (готовая игра)!

### Графический интерфейс

![](http://unity3d.unium.ru/lessons/lesson11/images/wasteland2.jpg)

Графический интерфейс пользователя (англ. Graphic User Interface, GUI) — это метод взаимодействия пользователя с игрой, в котором элементы интерфейса (меню, кнопки, значки, списки и т. п.), представленные пользователю на экране, выполнены в виде графических изображений.

Unity поддерживает несколько технологий для создания UI:

- **Legacy GUI**. До версии Unity 4.6 эта была единственная встроенная система для создания пользовательского интерфейса. Имеет ограниченные возможности, интерфейс не масштабируется под разные типы экранов;
- **Autodesk Scaleform**. Коммерческая реализация компании Autodesk. Позволяет создавать UI с помощью программы Adobe Flash и использовать его в Unity;
- **NGUI**. До версии Unity 4.6 это был самый популярный платный пакет для создания пользовательского интерфейса. Продается в Asset Store;
- **New GUI**. С версии Unity 4.6 разработчики создали новую систему пользовательского интерфейса. Позволяет создавать интерфейс для разных типов экрана, не имеет ограничений, открыт исходный код. Именно эту систему мы будем проходить на этом занятии.

### Canvas

Все элементы интерфейса (кнопки, изображения) должны находиться внутри объекта «**Canvas**». «**Canvas**» — это холст экрана, на котором размещаются элементы. Для создания холста в главном меню выбери «**GameObject**» → «**UI**» → «**Canvas**». На панели «**Inspector**» можно настроить параметры холста. Самая важная настройка — это «**Render Mode**» компонента «**Canvas**». Он отвечает за режим отображения интерфейса.

«**Render Mode**» содержит следующие настройки на выбор:

- «**Screen Space - Overlay**». Элементы интерфейса показываются поверх экрана. Стоит по умолчанию;
- «**Screen Space - Camera**». Позволяет отображать интерфейс в определенной камере;
- «**World Space**». В этом режиме элементы интерфейса располагаются в 3D пространстве.

### Rect Transform

Все элементы интерфейса имеют настройки «**Rect Transfrom**». Разберем их на примере кнопки (выбрав в главном меню «**GameObject**» → «**UI**» → «**Button**»).

Во время редактирования пользовательского интерфейса в Unity нужно включить режим 2D. Для этого на панели «**Scene**» нажми кнопку «**2D**»:

![](http://unity3d.unium.ru/lessons/lesson11/images/2d.png)

Включи инструмент редактирования пользовательского интерфейса на панели инструментов или нажми кнопку `T`. С помощью этого инструмента можно перемещать, вращать и изменять размер элементов интерфейса.

![](http://unity3d.unium.ru/lessons/lesson11/images/tool2d.png)

Выбери элемент интерфейса. Схватив за одну из точек по краям можно изменить размер элемента.

![](http://unity3d.unium.ru/lessons/lesson11/images/button_rect.jpg)

Anchor — это точка привязки элемента интерфейса на экране. Изменить расположение Anchor можно, если схватить за центр «цветка». Разберем пример, когда Anchor привязан к левому верхнему краю. Точка Anchor кнопки находится в левом верхнем углу. При изменении размера экрана – кнопка не изменяет свой размер и будет расположена на определенном расстоянии от левого верхнего угла. Следовательно, кнопка будет выглядеть большой на маленьком экране и маленькой на большом мониторе.

Примеры:

![img](http://unity3d.unium.ru/lessons/lesson11/images/anchor1.gif)
![img](http://unity3d.unium.ru/lessons/lesson11/images/anchor2.gif)

Для того, чтобы элемент интерфейса масштабировался — расположи «лепестки» Anchor так:

![img](http://unity3d.unium.ru/lessons/lesson11/images/anchor3.gif)
![img](http://unity3d.unium.ru/lessons/lesson11/images/anchor4.gif)

### Button

Создать кнопку можно в главном меню «**GameObject**» → «**UI**» → «**Button**». Кнопка состоит из двух элементов, которые можно посмотреть на панели «**Hierarchy**»: формы и текста внутри нее:

![](http://unity3d.unium.ru/lessons/lesson11/images/button_hierarchy.png)

Сначала разберем настройки надписи на кнопке. Выбери «**Text**» на панели «**Hierarchy**». В «**Inspector**» будут следующие настройки текста:

- «**Text**» — текст кнопки;
- «**Font Size**» — размер текста.

Теперь, рассмотрим настройки формы кнопки. Выбери объект «**Button**» (название этого объекта можно изменить). На панели «**Inspector**» находятся следующие основные настройки:

- «**Normal Color**». Цвет кнопки;
- «**Highlighted Color**». Цвет кнопки при наведении на нее мыши;
- «**Pressed Color**». Цвет нажатой кнопки.

### Обработка события нажатия на кнопку

С помощью uScript можно получать событие нажатия кнопки.

1. Создай новый uScript-скрипт;
2. добавь ноду события «**Events**» → «**UI Events**» → «**UI Button Events**»;
3. точку «**Instance**» соедини с переменной, в которой хранится кнопка (тип «**GameObject**»);
4. точку «**On Button Click**» соедини с нодами, которые хочешь выполнять во время нажатия на кнопку.

### Создание кнопки со своим дизайном

Рассмотрим пример создания круглой кнопки, состоящая из трех изображений: обычное состояние («**normal**»), состояние, когда на кнопку наведена мышь («**Hovered**») и состояние нажатия на кнопку («**Pressed**»).

![](http://unity3d.unium.ru/lessons/lesson11/images/buttondesign.png)

Сначала нужно загрузить все изображения кнопки в проект (в дальнейшем лучше использовать одно изображение, разделенное с помощью инструмента «**Sprite Editor**»). Выбери каждую текстуру и на панели «**Inspector**» в параметре «**Texture Type**» выбери «**Sprite (2D and UI)**».

![](http://unity3d.unium.ru/lessons/lesson11/images/texturetype1.png)

Создай кнопку «**GameObject**» → «**UI**» → «**Button**», задав ей размер и положение. На панели «**Inspector**» в компоненте «**Image (Script)**» выбери следующие параметры:

- в параметре «**Source Image**» выбери изображение кнопки («**normal**»);
- если изображение черно-белое, то можно его перекрасить в параметре «**Color**»;
- в параметре «**Image Type**» выбери «**Simple**», т.к. данная кнопка не будет менять свои пропорции;
- включи настройку «**Preserve Aspect**», чтобы кнопка не деформировалась при изменении разрешения экрана.

В компоненте «**Button (Script)**» выбери следующие параметры:

- В параметре «**Transition**» выбери «**Sprite Swap**». Данная настройка позволяет выбрать разные изображения кнопок при наведении и нажатия мыши;
- В параметре «**Target Graphic**»должен быть выбран объект кнопки (стоит по умолчанию);
- В параметре «**Highlighted Sprite**» выбери текстуру, которая будет отображаться на кнопке при наведении мыши;
- В параметре «**Pressed Sprite**» выбери текстуру, которая будет отображаться на кнопке при нажатии.

![img](http://unity3d.unium.ru/lessons/lesson11/images/simpleimagebutton.jpg)

### Создание кнопок с помощью Sprite Editor

С помощью инструмента «**Spite Editor**» кнопки не будут деформироваться при изменении размера экрана. Также, производительность игры возрастет, если все элементы интерфейса расположены на одной текстуре (такая текстура называется атлас, а элемент атласа — спрайтом).

![](http://unity3d.unium.ru/lessons/lesson11/images/button_issue.jpg)

Рассмотрим пример на этой текстуре:

![](http://unity3d.unium.ru/lessons/lesson11/images/sprite_buttons.png)

Импортируй ее в проект игры. В настройке «**Texture Type**» выбери «**Sprite (2D and UI)**», в параметре «**Sprite Mode**» выбери «**Multiple**» и нажми кнопку «**Sprite Editor**», чтобы открылся редактор «**Sprite Editor**».

![](http://unity3d.unium.ru/lessons/lesson11/images/sprite_editor1.jpg)

Управление в редакторе осуществляется следующим образом:

- приближение или отдаление осуществляется с помощью колеса прокрутки мыши;
- перемещение вида осуществляется с помощью ![img](http://unity3d.unium.ru/images/mmb.png).

С помощью прямоугольного выделения раздели текстуру на части, где каждый элемент — отдельная кнопка. За синие точки можно изменить размер элемента. Кнопки разделены по трем колонкам: обычное состояние (Normal), состояние наведения мыши (Highlighted) и состояние нажатия на кнопку (Pressed). Введи каждому элементу имя состояния кнопки:

![](http://unity3d.unium.ru/lessons/lesson11/images/sprite_editor2.jpg)

Теперь нужно настроить фрагменты кнопки, которые не будут изменять свой размер при масштабировании элемента. Перетащи зеленые точки так, чтобы область находилась внутри кнопки и не затрагивала углы:

![](http://unity3d.unium.ru/lessons/lesson11/images/sprite_editor3.jpg)

Повтори эти операции для всех кнопок на текстуре и нажми кнопку «**Apply**».

![](http://unity3d.unium.ru/lessons/lesson11/images/sprite_editor4.jpg)

На сцене создай кнопку. Расположи точки «**Anchor Points**» так:

![](http://unity3d.unium.ru/lessons/lesson11/images/sprite_editor5.jpg)

Выдели кнопку. На панели «**Inspector**» выбери следующие настройки:

- в параметре «**Source Image**» выбери спрайт кнопки в обычном состоянии (normal);
- в параметре «**Image Type**» выбери «**Sliced**»;
- в параметре «**Transition**» выбери «**Sprite Swap**»;
- в параметре «**Highlighted Sprite**» выбери спрайт подсвеченной кнопки;
- в параметре «**Pressed Sprite**» выбери спрайт нажатой кнопки.
- ![](http://unity3d.unium.ru/lessons/lesson11/images/sprite_editor6.jpg)

### Image

«**GameObject**» → «**UI**» → «**Image**» позволяет показывать на переднем плане экрана изображения такие как карта, значок жизни, магии и прочее.

Добавь в проект изображение, которое будет использоваться в графическом интерфейсе.

На панели «**Inspector**» изображения выбери следующие настройки:

- в параметре «**Texture Type**» выбери «**Sprite (2D or UI)**»;
- в параметре «**Sprite Mode**» выбери «**Single**».

Добавь на сцену «**GameObject**» → «**UI**» → «**Image**». На панели «**Inspector**» выбери следующие настройки:

- в параметре «**Source Image**» выбери загруженное изображение;
- в параметре «**Color**» можно перекрасить изображение в определенный цвет;
- в параметре «**Image Type**» выбери «**Simple**». Если включить настройку «**Preserve Aspect**», то изображение не будет деформироваться при изменении размера экрана. Если в настройке «**Image Type**» выбрать «**Tiled**» — изображение будет повторяться на экране.

### Text

«**GameObject**» → «**UI**» → «**Text**» позволяет отображать текст в графическом интерфейсе (отображение диалогов, подсказок, надписей). Содержит следующие настройки:

- «**Text**» — текст, который будет отображаться на экране;
- «**Font**» — шрифт текстаи;
- «**Font Style**» — тип шрифта. Принимает следующие значения:
- - «**Normal**» – обычный шрифт;
  - «**Bold**» – применение полужирного начертания к тексту;
  - «**Italic**» – применение курсивного начертания к тексту;
  - «**Bold and Italic**» – применение курсивного и полужирного начертания к текст.
- «**Font Size**» — размер шрифта;
- «**Alignment**» — выравнивание текста;
- «**Color**» — цвет текста.

![](http://unity3d.unium.ru/lessons/lesson11/images/text.jpg)

### Замена шрифта

Шрифт можно поменять на любой другой:

1. Скачай шрифт из интернета (убедись, что его можно использовать в играх без нарушения прав) или скопируй шрифт, установленный в операционной системе. Если у тебя операционная система Windows, то зайди в папку «C:\Windows\Fonts\», выбери нужный шрифт и скопируй на «**Рабочий стол**» или в любое другое место временно.
2. В Unity на панели «**Project**» нажми и выбери «**Import New Asset…**», выбери шрифт из пункта №1. На панели «**Inspector**» можешь изменить следующие настройки: «**Font Size**» – размер шрифта, «**Character**» – способ кодирования шрифта. Поставь значение «**Dynamic**», если шрифт это поддерживает, иначе выбери «**Unicode**», если требуется сохранить все символы; «**ASCII default set**» сохранит все основные символы; «**ASCII upper case**» – только большие буквы; «**ASCII lower case**» – только маленькие буквы; «**Custom set**» – только те буквы, которые задашь в параметре «**Custom Chars**».
3. Выбери объект «**Text**» пользовательского интерфейса и в параметре «**Font**» выбери шрифт.

### Изменение текста с помощью скрипта

Текст можно менять с помощью скрипта. Это позволит в режиме реального времени отображать количество набранных очков, жизни, времени и т.п.

1. Создай новый скрипт;
2. Создай ноду события, в которой хочешь менять текст на экране (например, «**Global Update**»);
3. Добавь ноду «**Set String**»;
4. На панели инструментов раскрой список «**Reflected**» → «**Properties**» → «**UnityEngine.UI.Text**» (если отсутствует, то перезапусти uScript Editor) и выбери в открывающимся списке «**text**». На холсте появится нода. Перетащи текстовый элемент с панели «**Hierarchy**» редактора Unity в созданную ноду;
5. Выбери ноду «**Set String**». На панели свойств в поле «**Value**» введи текст, а точку «**Target**» соедини с нодой, созданной на предыдущем шаге.

Готовый скрипт: